---
import Header from "../components/Header.astro";
import Main from "../components/Main.astro";
import Footer from "../components/Footer.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Sonorus">
  <Header />
  <Main />
  <Footer />
  <script>
    /* JS para formulario de registro comunidad (Main y Footer) */
    document.addEventListener('DOMContentLoaded', () => {
      // Main
      const joinBtn = document.getElementById('join-community-btn');
      const modal = document.getElementById('community-form-modal');
      const closeBtn = document.getElementById('close-form-btn');
      if (joinBtn && modal && closeBtn) {
        joinBtn.addEventListener('click', () => {
          modal.classList.remove('hidden');
        });
        closeBtn.addEventListener('click', () => {
          modal.classList.add('hidden');
        });
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.add('hidden');
          }
        });
        const form = modal.querySelector('form');
        if (form) {
          form.addEventListener('submit', (e) => {
            e.preventDefault();
            alert('¡Registro enviado!');
            modal.classList.add('hidden');
            form.reset();
          });
        }
      }

      // Footer
      const joinBtnFooter = document.getElementById('join-community-btn-footer');
      const modalFooter = document.getElementById('community-form-modal-footer');
      const closeBtnFooter = document.getElementById('close-form-btn-footer');
      if (joinBtnFooter && modalFooter && closeBtnFooter) {
        joinBtnFooter.addEventListener('click', () => {
          modalFooter.classList.remove('hidden');
        });
        closeBtnFooter.addEventListener('click', () => {
          modalFooter.classList.add('hidden');
        });
        modalFooter.addEventListener('click', (e) => {
          if (e.target === modalFooter) {
            modalFooter.classList.add('hidden');
          }
        });
        const formFooter = modalFooter.querySelector('form');
        if (formFooter) {
          formFooter.addEventListener('submit', (e) => {
            e.preventDefault();
            alert('¡Registro enviado!');
            modalFooter.classList.add('hidden');
            formFooter.reset();
          });
        }
      }
    });
    /* Código para Menú */
    const menu = document.getElementById("menu") as HTMLImageElement;
    const dropmenu = document.getElementById("dropmenu");

    menu?.addEventListener("click", () => {
      const isHidden = dropmenu?.classList.toggle("hidden");
      menu.src = isHidden ? "/menu.svg" : "/close.svg";
    });

    const links = document.querySelectorAll("nav a");
    links.forEach((link) => {
      link.addEventListener("click", () => {
        dropmenu?.classList.add("hidden");
        menu.src = "/menu.svg";
      });
    });
    /* JS Leonard para carrusel*/
    // Carrusel funcionalidad
    const images = [
      { src: "/album_1.webp", alt: "Nirvana" },
      { src: "/album_2.webp", alt: "Bocanada" },
      { src: "/album_3.webp", alt: "Red Hot Chili Peppers" },
      { src: "/album_4.webp", alt: "Vilma Palma" },
      { src: "/album_5.webp", alt: "top" },
      { src: "/album_6.webp", alt: "los prisioneros" },
      { src: "/album_7.webp", alt: "hombres g" },
    ];

    let currentIndex = 0;

    const carousel = document.getElementById("carousel");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    // Renderiza todas las imágenes en línea, pero solo se ven dos a la vez gracias al overflow-hidden del contenedor
    function renderCarousel() {
      carousel.innerHTML = "";
      images.forEach((imgData) => {
        const img = document.createElement("img");
        img.src = imgData.src;
        img.alt = imgData.alt;
        img.className = "rounded-lg shadow-lg object-cover flex-shrink-0";
        img.style.width = "140px";
        img.style.height = "197px";
        carousel.appendChild(img);
      });
      updateTransform();
    }

    function updateTransform() {
      // 140px (ancho) + 16px (gap-4) = 156px por imagen
      const offset = currentIndex * 156;
      carousel.style.transform = `translateX(-${offset}px)`;
    }

    prevBtn.addEventListener("click", () => {
      if (currentIndex - 2 >= 0) {
        currentIndex -= 2;
        updateTransform();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex + 2 < images.length) {
        currentIndex += 2;
        updateTransform();
      }
    });

    // Inicializar carrusel
    renderCarousel();
  </script>
</Layout>
