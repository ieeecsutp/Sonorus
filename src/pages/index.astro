---
import Header from "../components/Header.astro";
import Main from "../components/Main.astro";
import Footer from "../components/Footer.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Sonorus">
  <Header />
  <Main />
  <Footer />
  <script>
    /* Parte de Piero */
    //Código para el menú desplegable - Funcionalidad
    const menu = document.getElementById("menu") as HTMLImageElement;
    const dropmenu = document.getElementById("dropmenu");

    menu?.addEventListener("click", () => {
      const isHidden = dropmenu?.classList.toggle("hidden");
      menu.src = isHidden ? "/menu.svg" : "/close.svg";
    });

    const links = document.querySelectorAll("nav a");
    links.forEach((link) => {
      link.addEventListener("click", () => {
        dropmenu?.classList.add("hidden");
        menu.src = "/menu.svg";
      });
    });

    /* Parte de Leonard */

    // Para carrusel de álbumes - Funcionalidad
    interface ImageData {
      src: string;
      alt: string;
    }

    const images: ImageData[] = [
      { src: "/album_1.webp", alt: "Nirvana" },
      { src: "/album_2.webp", alt: "Bocanada" },
      { src: "/album_3.webp", alt: "Red Hot Chili Peppers" },
      { src: "/album_4.webp", alt: "Vilma Palma" },
      { src: "/album_5.webp", alt: "top" },
      { src: "/album_6.webp", alt: "los prisioneros" },
      { src: "/album_7.webp", alt: "hombres g" },
    ];

    let currentIndex = 0;

    // Forzamos el tipo correcto de cada elemento
    const carousel = document.getElementById(
      "carousel"
    ) as HTMLDivElement | null;
    const prevBtn = document.getElementById(
      "prevBtn"
    ) as HTMLButtonElement | null;
    const nextBtn = document.getElementById(
      "nextBtn"
    ) as HTMLButtonElement | null;

    function renderCarousel() {
      if (!carousel) return; // prevención de null
      carousel.innerHTML = "";

      images.forEach((imgData) => {
        const img = document.createElement("img");
        img.src = imgData.src;
        img.alt = imgData.alt;
        img.className = "rounded-lg shadow-lg object-cover flex-shrink-0";
        img.style.width = "140px";
        img.style.height = "197px";
        carousel.appendChild(img);
      });

      updateTransform();
    }

    function updateTransform() {
      if (!carousel) return;
      // 140px + 16px (gap) = 156px
      const offset = currentIndex * 156;
      carousel.style.transform = `translateX(-${offset}px)`;
    }

    prevBtn?.addEventListener("click", () => {
      if (currentIndex - 2 >= 0) {
        currentIndex -= 2;
        updateTransform();
      }
    });

    nextBtn?.addEventListener("click", () => {
      if (currentIndex + 2 < images.length) {
        currentIndex += 2;
        updateTransform();
      }
    });

    // Inicializar
    renderCarousel();

    // Formulario de registro comunidad (Main y Footer) - Funcionalidad
    document.addEventListener("DOMContentLoaded", () => {
      // Main
      const joinBtnMain = document.getElementById(
        "join-community-btn"
      ) as HTMLButtonElement | null;
      const modalMain = document.getElementById(
        "community-form-modal"
      ) as HTMLDivElement | null;
      const closeBtnMain = document.getElementById(
        "close-form-btn"
      ) as HTMLButtonElement | null;

      if (joinBtnMain && modalMain && closeBtnMain) {
        joinBtnMain.addEventListener("click", () => {
          modalMain.classList.remove("hidden");
          modalMain.classList.add("flex");
        });

        closeBtnMain.addEventListener("click", () => {
          modalMain.classList.add("hidden");
          modalMain.classList.remove("flex");
        });

        modalMain.addEventListener("click", (e) => {
          if (e.target === modalMain) {
            modalMain.classList.add("hidden");
            modalMain.classList.remove("flex");
          }
        });

        const formMain = modalMain.querySelector("form");
        formMain?.addEventListener("submit", (e) => {
          e.preventDefault();
          alert("¡Registro enviado!");
          modalMain.classList.add("hidden");
          modalMain.classList.remove("flex");
          formMain.reset();
        });
      }

      // Footer
      const joinBtnFooter = document.getElementById(
        "join-community-btn-footer"
      ) as HTMLButtonElement | null;
      const modalFooter = document.getElementById(
        "community-form-modal-footer"
      ) as HTMLDivElement | null;
      const closeBtnFooter = document.getElementById(
        "close-form-btn-footer"
      ) as HTMLButtonElement | null;

      if (joinBtnFooter && modalFooter && closeBtnFooter) {
        joinBtnFooter.addEventListener("click", () => {
          modalFooter.classList.remove("hidden");
          modalFooter.classList.add("flex");
        });

        closeBtnFooter.addEventListener("click", () => {
          modalFooter.classList.add("hidden");
          modalFooter.classList.remove("flex");
        });

        modalFooter.addEventListener("click", (e) => {
          if (e.target === modalFooter) {
            modalFooter.classList.add("hidden");
            modalFooter.classList.remove("flex");
          }
        });

        const formFooter = modalFooter.querySelector("form");
        formFooter?.addEventListener("submit", (e) => {
          e.preventDefault();
          alert("¡Registro enviado!");
          modalFooter.classList.add("hidden");
          modalFooter.classList.remove("flex");
          formFooter.reset();
        });
      }
    });
  </script>
</Layout>
